<!-- 
    Composant réutilisable pour afficher un champ de formulaire avec validation
    
    Usage:
    {% include 'components/form_field.html' with field=form.username label="Nom d'utilisateur" required=True %}
    {% include 'components/form_field.html' with field=form.email label="Email" type="email" required=True %}
    {% include 'components/form_field.html' with field=form.description label="Description" widget="textarea" %}
-->

{% load static %}

<div class="form-group {% if field.errors %}has-error{% endif %}">
    <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
        {{ label|default:field.label }}
        {% if required|default:field.field.required %}
            <span class="text-red-500">*</span>
        {% endif %}
    </label>
    
    {% if widget == 'textarea' %}
        <textarea 
            name="{{ field.html_name }}" 
            id="{{ field.id_for_label }}"
            {% if required|default:field.field.required %}required{% endif %}
            {% if rows %}rows="{{ rows }}"{% else %}rows="4"{% endif %}
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-lily-purple focus:border-transparent transition
                   {% if field.errors %}border-red-500 focus:ring-red-500{% else %}border-gray-300{% endif %}
                   {{ extra_class }}"
            {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
            {% if field.field.disabled %}disabled{% endif %}
            {% if field.field.max_length %}maxlength="{{ field.field.max_length }}"{% endif %}
        >{{ field.value|default:'' }}</textarea>
    {% elif widget == 'select' %}
        <select 
            name="{{ field.html_name }}" 
            id="{{ field.id_for_label }}"
            {% if required|default:field.field.required %}required{% endif %}
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-lily-purple focus:border-transparent transition
                   {% if field.errors %}border-red-500 focus:ring-red-500{% else %}border-gray-300{% endif %}
                   {{ extra_class }}"
            {% if field.field.disabled %}disabled{% endif %}
        >
            <option value="">{{ placeholder|default:"Sélectionnez une option" }}</option>
            {% for choice_value, choice_label in field.field.choices %}
                {% if choice_value %}
                    <option value="{{ choice_value }}" {% if field.value|stringformat:"s" == choice_value|stringformat:"s" %}selected{% endif %}>
                        {{ choice_label }}
                    </option>
                {% endif %}
            {% endfor %}
        </select>
    {% elif widget == 'checkbox' %}
        <div class="flex items-start">
            <input 
                type="checkbox" 
                name="{{ field.html_name }}" 
                id="{{ field.id_for_label }}"
                {% if field.value %}checked{% endif %}
                {% if required|default:field.field.required %}required{% endif %}
                class="mt-1 h-4 w-4 text-lily-purple focus:ring-lily-purple border-gray-300 rounded
                       {% if field.errors %}border-red-500{% endif %}
                       {{ extra_class }}"
                {% if field.field.disabled %}disabled{% endif %}
            >
            <label for="{{ field.id_for_label }}" class="ml-2 text-sm text-gray-700">
                {{ label|default:field.label }}
                {% if help_text %}
                    <span class="block text-xs text-gray-500 mt-1">{{ help_text }}</span>
                {% endif %}
            </label>
        </div>
    {% elif widget == 'file' %}
        <input 
            type="file" 
            name="{{ field.html_name }}" 
            id="{{ field.id_for_label }}"
            {% if required|default:field.field.required %}required{% endif %}
            {% if accept %}accept="{{ accept }}"{% endif %}
            {% if multiple %}multiple{% endif %}
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-lily-purple focus:border-transparent transition
                   file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium
                   file:bg-lily-purple file:text-white hover:file:bg-opacity-90 file:cursor-pointer
                   {% if field.errors %}border-red-500 focus:ring-red-500{% else %}border-gray-300{% endif %}
                   {{ extra_class }}"
            {% if field.field.disabled %}disabled{% endif %}
        >
    {% else %}
        <input 
            type="{{ type|default:'text' }}" 
            name="{{ field.html_name }}" 
            id="{{ field.id_for_label }}"
            value="{{ field.value|default:'' }}"
            {% if required|default:field.field.required %}required{% endif %}
            {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
            {% if field.field.max_length and type != 'email' and type != 'url' %}maxlength="{{ field.field.max_length }}"{% endif %}
            {% if min %}min="{{ min }}"{% endif %}
            {% if max %}max="{{ max }}"{% endif %}
            {% if step %}step="{{ step }}"{% endif %}
            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-lily-purple focus:border-transparent transition
                   {% if field.errors %}border-red-500 focus:ring-red-500 bg-red-50{% else %}border-gray-300{% endif %}
                   {{ extra_class }}"
            {% if field.field.disabled %}disabled{% endif %}
            {% if autocomplete %}autocomplete="{{ autocomplete }}"{% endif %}
        >
    {% endif %}
    
    <!-- Messages d'erreur sous le champ -->
    {% if field.errors %}
        <div class="mt-2 space-y-1">
            {% for error in field.errors %}
                <p class="text-sm text-red-600 flex items-start">
                    <svg class="w-4 h-4 mr-1 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    <span>{{ error }}</span>
                </p>
            {% endfor %}
        </div>
    {% endif %}
    
    <!-- Texte d'aide (si pas de checkbox) -->
    {% if help_text and widget != 'checkbox' %}
        <p class="mt-2 text-sm text-gray-500">
            {{ help_text }}
        </p>
    {% endif %}
</div>
