{% extends 'base.html' %}
{% load thumbnail_tags %}

{% block title %}Nos prestataires - LysAngels{% endblock %}

{% block meta_description %}D√©couvrez notre s√©lection de prestataires √©v√©nementiels premium au Togo : photographes, musiciens, DJ, traiteurs, d√©corateurs. Comparez, contactez et r√©servez en ligne.{% endblock %}

{% block meta_keywords %}liste prestataires Togo, photographe mariage, DJ √©v√©nement, musicien Lom√©, traiteur, d√©corateur, prestataires v√©rifi√©s{% endblock %}

{% block extra_css %}
<style>
    /* Banni√®re Hero avec personnalit√© */
    .vendor-hero {
        background: linear-gradient(135deg, #1A1A1A 0%, #2D1B3D 50%, #1A1A1A 100%);
        position: relative;
        overflow: hidden;
    }

    /* Alternative: match about/how-it-works gradient */
    .vendor-hero {
        background: linear-gradient(to bottom right, #1A1A1A, #2D1B3D, #3D2554);
    }

    .vendor-hero::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-image:
            radial-gradient(circle at 25% 75%, rgba(139, 92, 246, 0.2) 0%, transparent 50%),
            radial-gradient(circle at 75% 25%, rgba(212, 175, 55, 0.15) 0%, transparent 50%);
        opacity: 1;
    }

    .vendor-hero::after {
        content: '';
        background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 1;
        position: absolute;
        inset: 0;
        pointer-events: none;
    }

    /* √âl√©ments flottants anim√©s */
    .floating-icon {
        position: absolute;
        animation: float 6s ease-in-out infinite;
        opacity: 0.15;
        filter: blur(1px);
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
    }

    .floating-icon:nth-child(2) {
        animation-delay: 1s;
        animation-duration: 7s;
    }

    .floating-icon:nth-child(3) {
        animation-delay: 2s;
        animation-duration: 8s;
    }

    /* Shimmer effect sur le titre */
    @keyframes shimmer {
        0% { background-position: -200% center; }
        100% { background-position: 200% center; }
    }

    .shimmer-text {
        background: linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.9) 0%,
            rgba(255, 255, 255, 1) 50%,
            rgba(255, 255, 255, 0.9) 100%
        );
        background-size: 200% auto;
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: shimmer 3s linear infinite;
    }

    /* Badge anim√© */
    @keyframes badge-pulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
        50% { box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
    }

    .badge-animated {
        animation: badge-pulse 2s ease-in-out infinite;
    }

    /* Masquer la scrollbar tout en gardant le scroll */
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }

    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    /* Smooth scroll snap */
    .snap-x {
        scroll-snap-type: x mandatory;
        scroll-padding: 1rem;
    }

    .snap-start {
        scroll-snap-align: start;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-lily-cream min-h-screen">
    <!-- Header Hero avec personnalit√© -->
    <div class="vendor-hero py-20 md:py-24 relative">
        <!-- Decorative animated elements -->
        <div class="absolute inset-0 overflow-hidden">
            <div class="absolute w-96 h-96 bg-lily-gold/10 rounded-full blur-3xl -top-20 -right-20 animate-pulse"></div>
            <div class="absolute w-80 h-80 bg-lily-rose/10 rounded-full blur-3xl -bottom-20 -left-20 animate-pulse" style="animation-delay: 1s;"></div>
            <div class="absolute w-64 h-64 bg-lily-purple/10 rounded-full blur-3xl top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 animate-pulse" style="animation-delay: 2s;"></div>
        </div>

        <!-- Ic√¥nes flottantes d√©coratives -->
        <div class="floating-icon" style="top: 20%; left: 10%; font-size: 3rem;">üé≠</div>
        <div class="floating-icon" style="top: 60%; right: 15%; font-size: 2.5rem;">üì∏</div>
        <div class="floating-icon" style="top: 40%; right: 8%; font-size: 2rem;">üéµ</div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="text-center max-w-4xl mx-auto">
                <!-- Badge anim√© -->
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/10 backdrop-blur-sm border border-white/20 rounded-full mb-6 badge-animated">
                    <svg class="w-4 h-4 text-lily-gold" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                    </svg>
                    <span class="text-white text-sm font-medium">{{ total_vendors }}+ Professionnels V√©rifi√©s</span>
                </div>

                <!-- Titre principal avec effet shimmer -->
                <h1 class="font-display text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight">
                    <span class="shimmer-text">Trouvez Votre</span><br>
                    <span class="text-gradient-gold">Prestataire Id√©al</span>
                </h1>

                <!-- Description enrichie -->
                <p class="text-lg sm:text-xl text-gray-300 mb-8 leading-relaxed max-w-2xl mx-auto">
                    Des photographes talentueux aux DJ enflamm√©s, en passant par les traiteurs d'exception.
                    <span class="text-lily-gold font-medium">Tous les professionnels</span> dont vous avez besoin pour votre √©v√©nement parfait.
                </p>

                <!-- Stats mini -->
                <div class="grid grid-cols-3 gap-6 max-w-2xl mx-auto pt-8 border-t border-white/10">
                    <div class="text-center">
                        <div class="text-3xl md:text-4xl font-bold text-white mb-1">{{ total_vendors }}+</div>
                        <div class="text-xs md:text-sm text-gray-400">Prestataires</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl md:text-4xl font-bold text-white mb-1">{{ completed_projects }}</div>
                        <div class="text-xs md:text-sm text-gray-400">√âv√©nements R√©ussis</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl md:text-4xl font-bold text-lily-gold mb-1">{{ satisfaction_rate }}%</div>
                        <div class="text-xs md:text-sm text-gray-400">Satisfaction</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section de recherche qui chevauche l√©g√®rement la banni√®re -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-8 relative z-20">
        <!-- Barre de recherche principale - Effet card flottante premium -->
        <div class="mb-12 animate-fade-in-up">
            <form method="get" class="relative max-w-4xl mx-auto">
                <div class="relative bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden transition-all hover:shadow-3xl focus-within:shadow-3xl focus-within:border-lily-purple group">
                    <!-- Gradient subtil au hover -->
                    <div class="absolute inset-0 bg-gradient-to-r from-lily-purple/5 to-lily-gold/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

                    <!-- Ic√¥ne de recherche √† gauche -->
                    <div class="absolute left-6 top-1/2 -translate-y-1/2 text-gray-400 transition-colors group-focus-within:text-lily-purple z-10">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>

                    <!-- Input de recherche -->
                    <input type="text"
                           name="search"
                           value="{% if search_query %}{{ search_query }}{% endif %}"
                           placeholder="Photographe, DJ, Traiteur... Trouvez votre prestataire id√©al"
                           class="relative z-10 w-full pl-16 pr-40 py-5 text-base text-gray-700 placeholder-gray-400 bg-transparent focus:outline-none">

                    <!-- Bouton de recherche -->
                    <button type="submit"
                            class="btn btn-primary absolute right-3 top-1/2 -translate-y-1/2 z-10">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <span class="hidden sm:inline">Rechercher</span>
                    </button>
                </div>

                <!-- Pr√©server les autres filtres dans la recherche -->
                {% if selected_service %}
                    <input type="hidden" name="service_type" value="{{ selected_service }}">
                {% endif %}
                {% if selected_city %}
                    <input type="hidden" name="city" value="{{ selected_city }}">
                {% endif %}
            </form>
        </div>

        <!-- Cat√©gories populaires - Navigation rapide horizontale -->
        <div class="mb-12">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-semibold text-lily-dark">Cat√©gories Populaires</h2>
                <a href="?{% if search_query %}search={{ search_query }}{% endif %}" class="text-sm text-lily-purple hover:text-lily-gold transition font-medium flex items-center gap-1">
                    Tout voir
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            </div>

            <!-- Scroll horizontal de cat√©gories -->
            <div class="flex gap-4 overflow-x-auto pb-4 scrollbar-hide snap-x snap-mandatory">
                {% for service in service_types|slice:":8" %}
                <a href="?service_types={{ service.id }}"
                   class="snap-start flex-shrink-0 group">
                    <div class="card-minimal hover:card-featured transition-all duration-300 w-36 h-40 flex flex-col items-center justify-center text-center p-4">
                        <!-- Ic√¥ne du service (utiliser les m√™mes ic√¥nes que homepage) -->
                        <div class="w-14 h-14 bg-lily-purple/10 group-hover:bg-lily-purple rounded-2xl flex items-center justify-center mb-3 transition-all duration-300 group-hover:scale-110">
                            {% if 'photo' in service.name|lower %}
                                <svg class="w-8 h-8 text-lily-purple group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            {% elif 'DJ' in service.name or 'music' in service.name|lower %}
                                <svg class="w-8 h-8 text-lily-purple group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                                </svg>
                            {% elif 'd√©co' in service.name|lower or 'fleur' in service.name|lower %}
                                <svg class="w-8 h-8 text-lily-purple group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
                                </svg>
                            {% elif 'traiteur' in service.name|lower %}
                                <svg class="w-8 h-8 text-lily-purple group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            {% else %}
                                <svg class="w-8 h-8 text-lily-purple group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                </svg>
                            {% endif %}
                        </div>
                        <h3 class="font-medium text-sm text-gray-700 group-hover:text-lily-purple transition-colors">
                            {{ service.name|truncatewords:3 }}
                        </h3>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- Filtres avanc√©s (collapsibles) -->
        <div class="bg-gradient-to-br from-white to-lily-cream/30 rounded-xl shadow-md border border-gray-200 mb-8">
            <!-- En-t√™te des filtres avanc√©s -->
            <button type="button" id="toggleFilters" class="w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition rounded-xl">
                <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-lily-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                    <h3 class="font-medium text-gray-900">Filtres de recherche</h3>
                    {% if selected_service_types or selected_cities or selected_quartiers %}
                        <span class="px-2 py-1 bg-lily-purple text-white text-xs rounded-full font-light">
                            Filtres actifs
                        </span>
                    {% endif %}
                </div>
                <svg id="filterIcon" class="w-5 h-5 text-gray-500 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>

            <!-- Contenu des filtres avanc√©s (collapsible) -->
            <div id="filtersContent" class="hidden border-t border-gray-200">
                <form method="get" class="p-6 space-y-6">
                    <!-- Conserver la recherche si elle existe -->
                    {% if search_query %}
                        <input type="hidden" name="search" value="{{ search_query }}">
                    {% endif %}

                    <!-- Services -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Types de services
                        </label>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            {% for service in service_types %}
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-lily-purple hover:bg-gray-50 transition font-light
                                   {% if service.id|stringformat:'s' in selected_service_types %}border-lily-purple bg-lily-cream{% endif %}">
                                <input type="checkbox" name="service_types" value="{{ service.id }}"
                                       {% if service.id|stringformat:'s' in selected_service_types %}checked{% endif %}
                                       class="w-4 h-4 text-lily-purple border-gray-300 rounded focus:ring-lily-purple">
                                <span class="ml-2 text-sm text-gray-700 font-light">{{ service.name }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Localisation -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            Localisation
                        </label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Pays -->
                            <div>
                                <p class="text-xs font-medium text-gray-600 mb-2 uppercase">Pays</p>
                                <div class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                                    {% for country in countries %}
                                    <label class="flex items-center cursor-not-allowed p-2 rounded opacity-60">
                                        <input type="checkbox" name="countries" value="{{ country.id }}"
                                               {% if country.code == 'TG' %}checked{% endif %}
                                               disabled
                                               class="w-4 h-4 text-lily-purple border-gray-300 rounded">
                                        <span class="ml-2 text-sm text-gray-700">{{ country.flag_emoji }} {{ country.name }}</span>
                                    </label>
                                    {% empty %}
                                    <p class="text-sm text-gray-500 p-2">Aucun pays disponible</p>
                                    {% endfor %}
                                    <p class="text-xs text-gray-500 mt-2 italic">Disponible uniquement au Togo pour le moment</p>
                                </div>
                            </div>

                            <!-- Villes -->
                            <div>
                                <p class="text-xs font-medium text-gray-600 mb-2 uppercase">Villes</p>
                                <div class="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3">
                                    {% for city in cities %}
                                    <label class="flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded">
                                        <input type="checkbox" name="cities" value="{{ city.id }}"
                                               {% if city.id|stringformat:'s' in selected_cities %}checked{% endif %}
                                               class="w-4 h-4 text-lily-purple border-gray-300 rounded focus:ring-lily-purple city-checkbox"
                                               data-city-id="{{ city.id }}">
                                        <span class="ml-2 text-sm text-gray-700">{{ city.name }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- Quartiers -->
                            <div>
                                <p class="text-xs font-medium text-gray-600 mb-2 uppercase">Quartiers</p>
                                <div class="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3">
                                    {% for quartier in quartiers %}
                                    <label class="flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded quartier-item" data-city="{{ quartier.city.id }}">
                                        <input type="checkbox" name="quartiers" value="{{ quartier.id }}"
                                               {% if quartier.id|stringformat:'s' in selected_quartiers %}checked{% endif %}
                                               class="w-4 h-4 text-lily-purple border-gray-300 rounded focus:ring-lily-purple">
                                        <span class="ml-2 text-sm text-gray-700">{{ quartier.name }} <span class="text-xs text-gray-500">({{ quartier.city.name }})</span></span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Boutons -->
                    <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200">
                        <button type="submit" class="btn btn-primary">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Appliquer les filtres
                        </button>
                        {% if selected_service_types or selected_cities or selected_quartiers %}
                            <a href="?{% if search_query %}search={{ search_query }}{% endif %}" class="btn btn-ghost">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                R√©initialiser tout
                            </a>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle filters visibility
            const toggleBtn = document.getElementById('toggleFilters');
            const filtersContent = document.getElementById('filtersContent');
            const filterIcon = document.getElementById('filterIcon');

            // Auto-expand if filters are active
            const hasFilters = {% if selected_service_types or selected_cities or selected_quartiers %}true{% else %}false{% endif %};
            if (hasFilters) {
                filtersContent.classList.remove('hidden');
                filterIcon.classList.add('rotate-180');
            }

            toggleBtn.addEventListener('click', function() {
                filtersContent.classList.toggle('hidden');
                filterIcon.classList.toggle('rotate-180');
            });

            // Filter quartiers by selected cities
            const cityCheckboxes = document.querySelectorAll('.city-checkbox');
            const quartierItems = document.querySelectorAll('.quartier-item');

            function filterQuartiers() {
                const selectedCities = Array.from(cityCheckboxes)
                    .filter(cb => cb.checked)
                    .map(cb => cb.dataset.cityId);

                quartierItems.forEach(item => {
                    const cityId = item.dataset.city;
                    if (selectedCities.length === 0 || selectedCities.includes(cityId)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                        // Uncheck hidden quartiers
                        const checkbox = item.querySelector('input[type="checkbox"]');
                        if (checkbox) checkbox.checked = false;
                    }
                });
            }

            cityCheckboxes.forEach(cb => {
                cb.addEventListener('change', filterQuartiers);
            });

            // Initial filter on page load
            filterQuartiers();
        });
        </script>

        <!-- Affichage par cat√©gories (sans filtres) -->
        {% if display_mode == 'categories' %}
            {% for category in vendors_by_category %}
            <div class="mb-16 animate-fade-in-up">
                <!-- Titre de cat√©gorie -->
                <div class="flex items-center justify-between mb-6 pb-3 border-b border-gray-200">
                    <div>
                        <h2 class="text-lg font-medium text-lily-dark mb-0.5">
                            {{ category.service_type.name }}
                        </h2>
                        <p class="text-sm text-gray-500">
                            {{ category.vendors|length }} professionnel{{ category.vendors|length|pluralize }} disponible{{ category.vendors|length|pluralize }}
                        </p>
                    </div>

                    <a href="?service_types={{ category.service_type.id }}"
                       class="text-sm text-lily-purple hover:text-purple-dark font-medium flex items-center gap-1 transition-colors">
                        Voir tout
                        <svg class="w-4 h-4 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                </div>

                <!-- Grille de prestataires - Airbnb style -->
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-5">
                    {% for vendor in category.vendors %}
                        <a href="{% url 'vendors:vendor_detail' vendor.id %}"
                           class="{% if vendor.subscription_tier.name == 'Premium' %}card-featured{% else %}card-minimal{% endif %} card-animate-enter group">
                            <!-- Image avec ratio carr√© -->
                            <div class="relative aspect-square bg-gradient-to-br from-lily-rose to-lily-cream flex items-center justify-center overflow-hidden rounded-lg mb-3">
                                {% if vendor.images.first %}
                                    <img 
                                        src="{% thumbnail_url vendor.images.first.image 'medium' %}"
                                        srcset="{% responsive_srcset vendor.images.first.image 'small' 'medium' 'large' %}"
                                        sizes="(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 16vw"
                                        alt="{{ vendor.business_name }}"
                                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                                        loading="lazy"
                                        decoding="async">
                                {% else %}
                                    <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-lily-purple/10 to-lily-gold/10">
                                        <span class="text-4xl font-display text-lily-purple/40">{{ vendor.business_name|first }}</span>
                                    </div>
                                {% endif %}

                                <!-- Badge Premium -->
                                {% if vendor.subscription_tier.name == 'Premium' %}
                                    <span class="badge badge-premium badge-sm absolute top-2 right-2">
                                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                        </svg>
                                    </span>
                                {% endif %}
                                
                                <!-- Badge V√©rifi√© -->
                                {% if vendor.is_active %}
                                    <span class="absolute top-2 left-2 inline-flex items-center gap-1 px-2 py-1 bg-green-500 text-white rounded-full text-xs font-medium shadow-md">
                                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                    </span>
                                {% endif %}
                            </div>

                            <!-- Informations compactes -->
                            <div class="space-y-1">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-medium text-sm text-lily-dark truncate flex-1 pr-2">{{ vendor.business_name }}</h3>
                                </div>

                                <p class="text-gray-500 text-xs flex items-center">
                                    <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span class="truncate">{{ vendor.city }}</span>
                                </p>

                                <!-- Services tags -->
                                <div class="flex flex-wrap gap-1 pt-1">
                                    {% for service in vendor.service_types.all|slice:":2" %}
                                        <span class="badge badge-primary badge-sm">
                                            {{ service.name|truncatewords:2 }}
                                        </span>
                                    {% endfor %}
                                    {% if vendor.service_types.count > 2 %}
                                        <span class="badge badge-secondary badge-sm">
                                            +{{ vendor.service_types.count|add:"-2" }}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}

        <!-- Affichage en liste (avec filtres/recherche) -->
        {% elif display_mode == 'list' %}
        
        <!-- R√©sultats -->
        {% if vendors %}
            <div class="mb-4 flex items-center justify-between">
                <p class="text-gray-600 font-light">
                    {% if vendors.paginator.count == 1 %}
                        1 prestataire trouv√©
                    {% else %}
                        {{ vendors.paginator.count }} prestataires trouv√©s
                    {% endif %}
                </p>
                <p class="text-gray-500 text-sm font-light">
                    Page {{ vendors.number }} sur {{ vendors.paginator.num_pages }}
                </p>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-5">
                {% for vendor in vendors %}
                    <a href="{% url 'vendors:vendor_detail' vendor.id %}"
                       class="{% if vendor.subscription_tier.name == 'Premium' %}card-featured{% else %}card-minimal{% endif %} group animate-fade-in-up">
                        <!-- Image avec ratio carr√© -->
                        <div class="relative aspect-square bg-gradient-to-br from-lily-rose to-lily-cream flex items-center justify-center overflow-hidden rounded-lg mb-3">
                            {% if vendor.images.first %}
                                <img 
                                    src="{% thumbnail_url vendor.images.first.image 'medium' %}"
                                    srcset="{% responsive_srcset vendor.images.first.image 'small' 'medium' 'large' %}"
                                    sizes="(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 20vw"
                                    alt="{{ vendor.business_name }}"
                                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                                    loading="lazy"
                                    decoding="async">
                            {% else %}
                                <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-lily-purple/10 to-lily-gold/10">
                                    <span class="text-4xl font-display text-lily-purple/40">{{ vendor.business_name|first }}</span>
                                </div>
                            {% endif %}

                            <!-- Badge Premium -->
                            {% if vendor.subscription_tier.name == 'Premium' %}
                                <span class="badge badge-premium badge-sm absolute top-2 right-2">
                                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                    </svg>
                                </span>
                            {% endif %}
                            
                            <!-- Badge V√©rifi√© -->
                            {% if vendor.is_active %}
                                <span class="absolute top-2 left-2 inline-flex items-center gap-1 px-2 py-1 bg-green-500 text-white rounded-full text-xs font-medium shadow-md">
                                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                </span>
                            {% endif %}
                        </div>

                        <!-- Informations compactes -->
                        <div class="space-y-1">
                            <h3 class="font-medium text-sm text-lily-dark truncate">{{ vendor.business_name }}</h3>

                            <p class="text-gray-500 text-xs flex items-center">
                                <svg class="w-3 h-3 mr-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span class="truncate">{{ vendor.city }}</span>
                            </p>

                            <!-- Services tags -->
                            <div class="flex flex-wrap gap-1 pt-1">
                                {% for service in vendor.service_types.all|slice:":2" %}
                                    <span class="badge badge-primary badge-sm">
                                        {{ service.name|truncatewords:2 }}
                                    </span>
                                {% endfor %}
                                {% if vendor.service_types.count > 2 %}
                                    <span class="badge badge-secondary badge-sm">
                                        +{{ vendor.service_types.count|add:"-2" }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if vendors.has_other_pages %}
            <div class="mt-12 flex justify-center">
                <nav class="flex items-center gap-2">
                    {% if vendors.has_previous %}
                        <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_service %}service_type={{ selected_service }}&{% endif %}{% if selected_city %}city={{ selected_city }}&{% endif %}page={{ vendors.previous_page_number }}"
                           class="btn btn-ghost btn-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Pr√©c√©dent
                        </a>
                    {% else %}
                        <span class="btn btn-ghost btn-sm opacity-40 cursor-not-allowed">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                            Pr√©c√©dent
                        </span>
                    {% endif %}

                    <div class="flex gap-1">
                        {% for num in vendors.paginator.page_range %}
                            {% if vendors.number == num %}
                                <span class="btn btn-primary btn-sm">
                                    {{ num }}
                                </span>
                            {% elif num > vendors.number|add:'-3' and num < vendors.number|add:'3' %}
                                <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_service %}service_type={{ selected_service }}&{% endif %}{% if selected_city %}city={{ selected_city }}&{% endif %}page={{ num }}"
                                   class="btn btn-ghost btn-sm">
                                    {{ num }}
                                </a>
                            {% endif %}
                        {% endfor %}
                    </div>

                    {% if vendors.has_next %}
                        <a href="?{% if search_query %}search={{ search_query }}&{% endif %}{% if selected_service %}service_type={{ selected_service }}&{% endif %}{% if selected_city %}city={{ selected_city }}&{% endif %}page={{ vendors.next_page_number }}"
                           class="btn btn-ghost btn-sm">
                            Suivant
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    {% else %}
                        <span class="btn btn-ghost btn-sm opacity-40 cursor-not-allowed">
                            Suivant
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </span>
                    {% endif %}
                </nav>
            </div>
            {% endif %}
        {% else %}
            <!-- Empty State avec illustration -->
            <div class="empty-state">
                <div class="empty-state-icon">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <h3 class="empty-state-title">Aucun prestataire trouv√©</h3>
                <p class="empty-state-message">
                    Nous n'avons pas trouv√© de prestataire correspondant √† vos crit√®res de recherche.
                    Essayez d'√©largir vos filtres ou de modifier votre recherche.
                </p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                    <a href="{% url 'vendors:vendor_list' %}" class="btn btn-primary">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                        Voir tous les prestataires
                    </a>
                    <button onclick="document.getElementById('toggleFilters').click()" class="btn btn-secondary">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                        </svg>
                        Modifier les filtres
                    </button>
                </div>
            </div>
        {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}
